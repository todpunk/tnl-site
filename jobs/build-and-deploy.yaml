name: build-and-deploy
image: containers.catalystsquad.com/public/reactorcide/runnerbase:dev
capabilities:
  - docker
source:
  type: git
  url: https://github.com/todpunk/tnl-site.git
  ref: main
command: runnerlib run --job-command "bash /job/src/jobs/scripts/build-and-deploy.sh"
environment:
  # Registry configuration
  # Internal registry is HTTP-only, accessed by IP from within the cluster
  REGISTRY_INTERNAL: "10.16.0.1:5000"
  REGISTRY_INTERNAL_PATH: "private/todpunk/tnl-site"
  # External registry name (for values.yaml reference)
  REGISTRY_EXTERNAL: "containers.catalystsquad.com"

  # Registry credentials
  REGISTRY_USER: "${env:REGISTRY_USER}"
  REGISTRY_PASSWORD: "${secret:tnl-site/registry:password}"

  # Kubernetes configuration
  KUBECONFIG_CONTENT: "${secret:tnl-site/k8s:kubeconfig}"
  K8S_NAMESPACE: "tnl-site"

  # Helm configuration
  HELM_RELEASE: "tnl-site"
  HELM_CHART: "catalyst-helm/pysocha-site"
  HELM_CHART_VERSION: "1.1.1"
